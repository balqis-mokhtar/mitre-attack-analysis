# Attack Flow — SolarWinds (SUNBURST)

This document walks through the attack in chronological order, from initial compromise of SolarWinds through to discovery. Each step is written as its own section so it can later be mapped directly to MITRE ATT&CK techniques in `attck-mapping.md`.

---

## Stage 0 — Gaining Access to SolarWinds (Sep–Oct 2019)

The attack didn't start with the malware. It started months earlier, when the threat actors first gained unauthorized access to SolarWinds' internal network. The exact method of initial access has not been fully disclosed publicly.

Once inside, the attackers spent time studying SolarWinds' software build process — learning how code gets compiled, signed, and packaged into updates. This reconnaissance phase was essential for what came next.

In October 2019, they began testing code injection into the Orion platform. These were trial runs — small, controlled tests to confirm they could reliably insert code into the build pipeline without triggering errors or alerts.

**Key point:** The attackers didn't rush. They spent roughly five months studying and testing before deploying the actual malicious payload.

---

## Stage 1 — Injecting SUNBURST into the Build (Feb 2020)

On or around February 20, 2020, the attackers compiled and deployed the SUNBURST backdoor. The malicious code was embedded into a legitimate SolarWinds component: a DLL file called `SolarWinds.Orion.Core.BusinessLayer.dll`.

What made this particularly hard to catch:

- The code was written to match SolarWinds' existing coding style and conventions
- It was compiled alongside legitimate code, so it passed normal build checks
- It was digitally signed as a legitimate SolarWinds update — the signature was valid

The attackers also removed SUNBURST from SolarWinds' systems around June 4, 2020. By that point, enough malicious updates had already been distributed. Cleaning up reduced the chances of discovery during internal audits.

---

## Stage 2 — Distribution via Routine Update (Mar–Jun 2020)

Starting March 26, 2020, SolarWinds began pushing out Orion software updates that contained the SUNBURST backdoor to its customers. This was a normal update cycle — nothing unusual on SolarWinds' end, because they didn't know the code was compromised.

Over 18,000 organizations installed the update. This included U.S. government agencies (Treasury, Commerce, State, Homeland Security), major tech companies (Microsoft, Intel, Cisco), and private firms (FireEye, Deloitte).

At this point, SUNBURST was sitting on thousands of networks — but it wasn't doing anything yet.

---

## Stage 3 — Dormancy and Initial Beacon (Apr–May 2020)

After installation, SUNBURST deliberately waited 12–14 days before doing anything. This delay served two purposes: it made it harder to link any suspicious activity back to the software update, and it helped evade sandbox-based analysis tools that typically only run samples for a few minutes.

Once the waiting period ended, SUNBURST performed a series of checks before activating:

- It confirmed it was running on a machine inside the victim's domain (not a sandbox or test environment)
- It scanned for antivirus and forensics tools by checking running processes against a hardcoded blocklist — if any were found, it stopped executing and tried again later
- It disabled certain security-related services by modifying registry keys

Only after passing these checks did SUNBURST begin communicating with the attacker's command and control (C2) infrastructure.

---

## Stage 4 — Command and Control Communication

SUNBURST's C2 communications were designed to look like normal Orion traffic. Specifically:

- It used DNS queries to reach a subdomain of a malicious domain (`avsvmcloud.com`), but the subdomains were generated by a custom domain generation algorithm (DGA), making them look like random but legitimate hostnames
- The DNS queries carried encoded information about the victim — hostname, username, IP address, OS version — disguised within what looked like routine network activity
- Once the attacker responded via the DNS record, SUNBURST switched to HTTPS for further communication, mimicking SolarWinds' own Orion Improvement Program (OIP) protocol

The attacker used this initial contact to decide which victims were worth targeting further. Out of the 18,000+ infected organizations, only a few hundred were selected for deeper intrusion.

---

## Stage 5 — Second-Stage Payload Deployment (May–Jun 2020)

For the victims the attackers wanted to dig into, SUNBURST downloaded and executed a second-stage payload. The most well-documented of these is called **TEARDROP**.

TEARDROP was a memory-only dropper — it ran entirely in RAM and left minimal traces on disk. It read from a file named `gracious_truth.jpg`, which had a fake image file header but actually contained an encrypted, malicious payload. TEARDROP decrypted and loaded a customized version of **Cobalt Strike Beacon** directly into memory.

A variant called **RAINDROP** (identified by Symantec) served a similar purpose and was used for lateral movement across networks where SUNBURST had already established a foothold.

**Why this matters:** SUNBURST was the delivery mechanism. Cobalt Strike Beacon was the actual post-intrusion tool — the thing that gave the attackers hands-on-keyboard control.

---

## Stage 6 — Lateral Movement and Credential Theft

Once Cobalt Strike Beacon was in place on selected networks, the attackers moved laterally. Their approach was notably disciplined:

- They used stolen but legitimate credentials to move between systems — not custom exploits
- The credentials used for remote access were always different from those used for lateral movement, making it harder to correlate activity
- They used a technique called temporary file replacement: swapping a legitimate system utility with a malicious one, running their payload, then restoring the original file — leaving almost no trace
- Hostnames and IP addresses in their infrastructure were matched to the victim's country and environment to avoid standing out in network logs

Tools like PowerShell were used to run commands, move between systems, and stage data. Cobalt Strike's beacon checked in with C2 on customized schedules and used unique configurations for each victim network.

---

## Stage 7 — Data Exfiltration

Once inside the networks of interest, the attackers exfiltrated data. The specific data taken varied by victim — in the case of FireEye, the attackers stole the company's internal red team penetration testing tools. For government agencies, the targets were likely sensitive communications and policy documents.

Data was moved out using a combination of techniques: compressed files sent over HTTPS, and in some cases PowerShell-based commands to transfer data through email channels.

---

## Stage 8 — Discovery (Dec 2020)

On December 8, 2020, FireEye reported that its own network had been breached and that attackers had stolen its red team tools. While investigating that breach, FireEye discovered on December 11 that the compromise had come through a SolarWinds Orion update — and that this was a supply chain attack affecting many other organizations.

FireEye notified SolarWinds on December 12. Within days, CISA issued an emergency directive requiring all federal agencies to disconnect SolarWinds Orion. Microsoft and industry partners seized control of the `avsvmcloud.com` domain and turned it into a kill switch, sending commands that instructed SUNBURST instances to terminate themselves.

The attackers had maintained access to compromised networks for months — in some cases since spring 2020 — before anyone noticed.

---

## Summary of the Attack Chain

```
SolarWinds network compromised (Sep 2019)
    → Build process studied and tested (Oct 2019 – Feb 2020)
        → SUNBURST injected into Orion DLL (Feb 2020)
            → Malicious updates distributed to 18,000+ orgs (Mar 2020)
                → SUNBURST activates after 12–14 day delay, evades detection
                    → C2 communication via disguised DNS/HTTPS
                        → High-value targets selected (~few hundred)
                            → TEARDROP/RAINDROP deploy Cobalt Strike Beacon
                                → Lateral movement using stolen credentials
                                    → Data exfiltration
                                        → Discovered by FireEye (Dec 2020)
```
